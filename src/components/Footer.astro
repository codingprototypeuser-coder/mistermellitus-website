---
import { getCollection } from 'astro:content';

const today = new Date();

// Dynamische Seiten aus CMS laden
const pages = await getCollection('pages');

// Seiten für "Über"-Bereich (showInNav und nicht legal)
const ueberLinks = pages
  .filter((page) => page.data.showInNav && page.data.pageType !== 'legal')
  .sort((a, b) => (a.data.navOrder || 99) - (b.data.navOrder || 99))
  .map((page) => ({
    href: `/${page.data.slug || page.id}`,
    label: page.data.title,
  }));

// Rechtliche Seiten (pageType: legal)
const rechtlicheLinks = pages
  .filter((page) => page.data.pageType === 'legal')
  .map((page) => ({
    href: `/${page.data.slug || page.id}`,
    label: page.data.title,
  }));

const footerLinks = {
  ueber: [
    ...ueberLinks,
    { href: '/blog', label: 'Blog' },
  ],
  rechtliches: rechtlicheLinks,
};
---

<footer class="bg-[var(--bg-secondary)] border-t border-gray-200">
  <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
    <div class="grid grid-cols-1 md:grid-cols-4 gap-8">
      <!-- Brand -->
      <div class="md:col-span-2">
        <a href="/" class="inline-block mb-4">
          <img src="/images/logo.png" alt="Mister Mellitus" class="h-12 w-auto" />
        </a>
        <p class="text-[var(--text-muted)] text-sm max-w-sm">
          weil Süß sein nicht alles ist.
        </p>
        <p class="text-[var(--text-muted)] text-sm mt-4">
          Erfahrungen und Wissen aus über 10 Jahren mit Typ-2-Diabetes.
        </p>
      </div>

      <!-- Links: Über -->
      <div>
        <h3 class="font-semibold text-[var(--text-primary)] mb-4">Über</h3>
        <ul class="space-y-2">
          {footerLinks.ueber.map((link) => (
            <li>
              <a
                href={link.href}
                class="text-sm text-[var(--text-muted)] hover:text-[var(--primary)] transition-colors"
              >
                {link.label}
              </a>
            </li>
          ))}
        </ul>
      </div>

      <!-- Links: Rechtliches -->
      <div>
        <h3 class="font-semibold text-[var(--text-primary)] mb-4">Rechtliches</h3>
        <ul class="space-y-2">
          {footerLinks.rechtliches.map((link) => (
            <li>
              <a
                href={link.href}
                class="text-sm text-[var(--text-muted)] hover:text-[var(--primary)] transition-colors"
              >
                {link.label}
              </a>
            </li>
          ))}
        </ul>
      </div>
    </div>

    <!-- Bottom -->
    <div class="mt-12 pt-8 border-t border-gray-200">
      <div class="flex flex-col md:flex-row justify-between items-center gap-4">
        <p class="text-sm text-[var(--text-muted)]">
          &copy; {today.getFullYear()} Marcel Wieffering. Alle Rechte vorbehalten.
        </p>
        <p class="text-xs text-[var(--text-muted)]">
          Gestaltet mit zuckersüßer Liebe
        </p>
      </div>
    </div>
  </div>
</footer>
